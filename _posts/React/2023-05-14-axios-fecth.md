---
title: "axiosμ™€ fetch"

categories:
  - React
tags:
  - axios
  - fetch
toc: true
toc_sticky: true
toc_label: "λ©μ°¨"

date: 2023-05-14
last_modified_at: 2023-05-14
---

## 1. κ°μ”

Reactμ—μ„λ” apiλ¥Ό μ”μ²­ν• λ• μΌλ°μ μΌλ΅ axiosμ™€ fecthλ°©λ²•μ„ μ‚¬μ©ν•©λ‹λ‹¤.

μ €κ°™μ€ κ²½μ° ν° μ΄μ  μ—†μ΄ axiosλ§ μ‚¬μ©ν•΄μ™”μ§€λ§ μ΄ κΈ€μ—μ„λ” axiosμ™€ fetchλ¥Ό μ†κ°ν•κ³ , λ‘ λ°©λ²•μ νΉμ§•κ³Ό μ¥λ‹¨μ μ„ λΉ„κµν•μ—¬ μ–΄λ–¤ μƒν™©μ—μ„ μ–΄λ–¤ κ²ƒμ„ μ„ νƒν•΄μ•Ό ν•λ”μ§€ μ •λ¦¬ν•΄λ³΄κ³ μ ν•©λ‹λ‹¤

λ™μ‹μ— axiosμ μΈμ¤ν„΄μ¤λ¥Ό κ΄€λ¦¬ν•΄μ„ ν† ν°κ΄€λ¦¬λ¥Ό μ–΄λ–¤μ‹μΌλ΅ μν–‰ν•  μ μλ”μ§€ μ΄μ•ΌκΈ°ν•΄λ³΄κ² μµλ‹λ‹¤.

## 2. axios

"hello"λ¥Ό μ‘λ‹µκ°’μΌλ΅ μ£Όλ” apiλ¥Ό axiosλ¥Ό ν†µν•΄ κµ¬ν„ν• μμ‹ μ½”λ“λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

```javascript
import axios from "axios";

axios
  .get("https://api.example.com/data")
  .then((response) => {
    const data = response.data;
    console.log(data); // "hello"
  })
  .catch((error) => {
    console.error(error);
  });
```

### 2.1 νΉμ§•

[μ¥μ ]

1. XMLHttpRequest κ°μ²΄λ¥Ό κΈ°λ°μΌλ΅ ν•λ” ν¬λ΅μ¤ ν”λ«νΌ λΌμ΄λΈλ¬λ¦¬μ΄λ©° μ΄λ” λΈλΌμ°μ €μ™€ Node.js ν™κ²½ λ¨λ‘μ—μ„ μ‘λ™ν•  μ μλ‹¤λ” μ¥μ μ„ κ°€μ§€κ³  μμµλ‹λ‹¤.

2. HTTP μ”μ²­μ΄ μ‹¤ν¨ν–μ„ λ• μ‰½κ² μ—λ¬λ¥Ό μ²λ¦¬ν•  μ μλ” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤. HTTP μƒνƒ μ½”λ“, νƒ€μ„μ•„μ›ƒ λ“±μ„ μ„¤μ •ν•μ—¬ μ„Έλ°€ν• μ—λ¬ μ²λ¦¬λ¥Ό ν•  μ μμµλ‹λ‹¤.

3. μ”μ²­κ³Ό μ‘λ‹µμ„ κ°€λ΅μ±„κ³  λ³€ν•ν•λ” μΈν„°μ…‰ν„°(interceptor)λ¥Ό μ κ³µν•©λ‹λ‹¤. μ΄λ¥Ό μ‚¬μ©ν•λ©΄ μ”μ²­κ³Ό μ‘λ‹µμ„ μ¤‘κ°„μ— κ°€λ΅μ±„μ–΄ ν—¤λ” μμ •, μ¤λ¥ μ²λ¦¬, μ”μ²­/μ‘λ‹µ λ΅κΉ… λ“±μ μ‘μ—…μ„ μν–‰ν•  μ μμµλ‹λ‹¤.

4. μλ™μΌλ΅ JSON λ°μ΄ν„° λ³€ν™μ„ μ§€μ›ν•©λ‹λ‹¤

5. νƒ€μ„μ•„μ›ƒ μ„¤μ •μ΄ κ°€λ¥ν•©λ‹λ‹¤

[λ‹¨μ ]

1. λ³„λ„μ ν¨ν‚¤μ§€λ΅ μ κ³µλκΈ° λ•λ¬Έμ— μμ΅΄μ„±μ„ μ¶”κ°€ν•΄μ•Όν•©λ‹λ‹¤.

   ( `yarn add axios` λλ” `npm install axios` )

2. μΌλ¶€ κµ¬ν• λΈλΌμ°μ €μ—μ„ μ§€μ›λμ§€ μ•μ„ μ μμµλ‹λ‹¤.

   <img width="588" alt="image" src="https://github.com/teawon/2022-algorithm-study/assets/78795820/ffaeadc3-128b-40c9-8cd5-7ca80cc7f9b1">

   (23.05.14 κΈ°μ¤€ λ€λ¶€λ¶„μ λΈλΌμ°μ €μ—μ„ νΈν™μ΄ κ°€λ¥ν• λ“― ν•©λ‹λ‹¤)

## 3. fetch

λ™μΌν•κ² "hello"λ¥Ό μ‘λ‹µκ°’μΌλ΅ μ£Όλ” apiλ¥Ό fecth ν†µν•΄ κµ¬ν„ν• μμ‹ μ½”λ“λ” μ•„λμ™€ κ°™μµλ‹λ‹¤.

```javascript
fetch("https://api.example.com/data")
  .then((response) => {
    if (!response.ok) {
      throw new Error("Network response was not ok");
    }
    return response.json();
  })
  .then((data) => {
    console.log(data); // "hello"
  })
  .catch((error) => {
    console.error(error);
  });
```

### 3.1 νΉμ§•

[μ¥μ ]

1. μ›Ή λΈλΌμ°μ €μ λ‚΄μ¥ APIλ΅ λ³„λ„μ μ„¤μΉκ°€ ν•„μ” μ—†μµλ‹λ‹¤.

2. Promise κΈ°λ°μ΄λ―€λ΅ λΉ„λ™κΈ° μ²λ¦¬κ°€ κ°„νΈν•©λ‹λ‹¤.

3. μ”μ²­κ³Ό μ‘λ‹µ μ¤νΈλ¦Ό μ²λ¦¬κ°€ κ°€λ¥ν•©λ‹λ‹¤. (μ¤νΈλ¦¬λ° λ°μ΄ν„° μ²λ¦¬μ— μ μ©)

> μ¤νΈλ¦Ό μ²λ¦¬ : μ¤νΈλ¦Ό μ²λ¦¬λ” λ°μ΄ν„°λ¥Ό μ΅°κ°μΌλ΅ λ‚λ„μ–΄ μμ°¨μ μΌλ΅ μ²λ¦¬ν•λ” λ°©μ‹μΌλ΅, λ€μ©λ‰ λ°μ΄ν„°λ‚ μ§€μ†μ μΈ λ°μ΄ν„° νλ¦„μ΄ ν•„μ”ν• κ²½μ°μ— μ μ©ν•©λ‹λ‹¤.

[λ‹¨μ ]

1. κΈ°λ³Έμ μΌλ΅ JSON λ°μ΄ν„° λ³€ν™μ΄ μ΄λ£¨μ–΄μ§€μ§€ μ•μ•„ λ³„λ„μ μ²λ¦¬κ°€ ν•„μ”ν•©λ‹λ‹¤

   (μ„λ²„λ΅ JSONν•μ‹μ λ°μ΄ν„°λ¥Ό μ „μ†΅ν•κΈ° μ„ν•΄ JSON.stringifyλ¥Ό μ‚¬μ©ν•΄μ•Όν•©λ‹λ‹¤.)

2. μ—λ¬μ²λ¦¬κ°€ μƒλ€μ μΌλ΅ λ” λ³µμ΅ν•©λ‹λ‹¤

3. μ§€μ›ν•μ§€ μ•λ” λΈλΌμ°μ €κ°€ μ΅΄μ¬ν•©λ‹λ‹¤ (IE11)

## 4. μ •λ¦¬

μ‚¬μ‹¤ μ •λ¦¬ν•λ‹¤λ³΄λ‹ axiosλ¥Ό μ‚¬μ©ν•λ” μ΄μ μ— λ€ν• μ¥μ μ„ μ •λ¦¬ν• λλ‚μ΄ λ“λ„¤μ”

μ°Ύμ•„λ³΄λ‹ axiosλ³΄λ‹¤ fecthμ μ†λ„κ°€ λ” λΉ λ¥΄λ‹¤λ” μ •λ³΄λ„ μμ—μ§€λ§ μ„±λ¥ μ°¨μ΄κ°€ λ―Έλ―Έν•λ©°

<span style="color:red"> μ—λ¬μ²λ¦¬, μ”μ²­ κ°€λ΅μ±„κΈ°, νƒ€μ„μ•„μ›ƒ μ„¤μ •</span> λ¶€λ¶„μ„ μ§€μ›ν•λ” λ¶€λ¶„μ νΈμμ„±μ΄ λ›°μ–΄λ‚ axiosλ¥Ό μ‚¬μ©ν•λ”κ² λ” μΆ‹λ‹¤κ³  μƒκ°ν•©λ‹λ‹¤π‘

## 5.(λ¶€λ΅) axiosλ΅ μΈν„°μ…‰ν„° μ²λ¦¬ν•κΈ°

μ„ axiosμ μ¥μ μΈ μΈν„°μ…‰ν„° κΈ°λ¥μ„ ν†µν•΄ ν† ν°κ³Ό μ¬λ°κΈ‰ λ΅μ§μ— λ€ν• μ²λ¦¬λ¥Ό κ°„λ‹¨ν•κ² κµ¬ν„ν•  μ μμµλ‹λ‹¤.

μ•„λμ μƒν™©μ„ κ°€μ •ν•΄λ΄…μ‹λ‹¤.

> 1. λ¨λ“  apiμ μ”μ²­μ—λ” ν—¤λ”λ΅ accessTokenμ„ λ„£μ–΄ μ‚¬μ©μ μΈμ¦μ„ μ²λ¦¬ν•λ‹¤.
>
> 2. λ§μ•½ accessTokenμ΄ λ§λ£λλ©΄ 401μ—λ¬μ½”λ“λ¥Ό μ„λ²„μ—μ„ λ°ν™ν•λ‹¤.
>
> 3. 401μ—λ¬ λ°μƒμ‹ ν΄λΌμ΄μ–ΈνΈλ” refreshTokenλ¥Ό ν†µν•΄ accessTokenμ μ¬λ°κΈ‰ μ”μ²­μ„ μν–‰ν•λ‹¤.
>
> 4. accessToken λ§λ£μ‹ λ΅κ·ΈμΈ λ§λ£ λ©”μ„Έμ§€λ¥Ό λ„μ°κ³  λ©”μΈνμ΄μ§€λ΅ κ°•μ  μ΄λ™μ‹ν‚¨λ‹¤.

μ„ λ΅μ§μ„ μ²λ¦¬ν•λ ¤λ©΄ λ¨λ“  apiλ¥Ό μ”μ²­ν• λ• κ°κ° ν—¤λ”μ— ν† ν°μ •λ³΄λ¥Ό λ„£λ„λ΅ μ½”λ“λ¥Ό κµ¬ν„ν•΄μ•Όν•©λ‹λ‹¤.

λ§μ°¬κ°€μ§€λ΅ 401μ—λ¬κ°€ λ‚μ¤λ©΄ ν† ν°μ„ μ¬λ°κΈ‰ν•λ„λ΅ μ²λ¦¬ν•΄μ•Όλ§ ν•©λ‹λ‹¤.

κ³µν†µμ μΈ λ¶€λ¶„μ€ ν•λ²μ— λ¬¶μ–΄μ„ μ²λ¦¬ν•κ³  μ‹¶μ§€ μ•λ‚μ”?? λ°”λ΅ μ΄ λ¶€λ¶„μ—μ„ μΈν„°μ…‰ν„°λ¥Ό ν™μ©ν•  μ μμµλ‹λ‹¤.

### 5.1 μ”μ²­ μΈν„°μ…‰ν„°

```

import axios from 'axios';


const axiosInstance = axios.create({
  baseURL: "https://api.example.com/",
});

axiosInstance.interceptors.request.use(
  (config) => {
    const accessToken = localStorage.getItem('accessToken');
    if (accessToken) {
      config.headers.Authorization = `Bearer ${accessToken}`;
    }
    return config;
  },
  (error) => {
    return Promise.reject(error);
  },
);

```

μ²«λ²μ§Έλ” axiosμ μ”μ²­ μΈν„°μ…‰ν„°λ¥Ό μ„¤μ •ν•λ” λ¶€λ¶„μ…λ‹λ‹¤.

μΈν„°μ…‰ν„°λ€ μ”μ²­ λλ” μ‘λ‹µμ„ κ°€λ΅μ±„κ³  μ›ν•λ” μ²λ¦¬λ¥Ό ν•  μ μλ” κΈ°λ¥μΌλ΅ apiλ¥Ό μ”μ²­ν•κΈ° μ „μ— κ³µν†µμ μΌλ΅ λ„£μ–΄μ•Όν•λ” ν† ν°μ •λ³΄λ¥Ό ν—¤λ”μ— λ„£μ–΄ μ”μ²­ν•λ„λ΅ μ²λ¦¬ν•©λ‹λ‹¤.

μ²μ ν”„λ΅μ νΈλ¥Ό μ§„ν–‰ν–μ„λ•μ—λ” μ„ κΈ°λ¥μ„ λ°λΌ

μ•„λ μ½”λ“μ²λΌ κ° apiλ§λ‹¤ ν•λ‚ν•λ‚ headerμ— λ°μ΄ν„°λ¥Ό λ„£λ„λ΅ μ²λ¦¬ν–μ—μµλ‹λ‹¤π¥

```javascript

 axios({
        method: "post",
        url: `...`,
        headers: { Authorization: "Bearer " + localStorage.accessToken },
      })
        .then(function (response) {
           { ... }
        })

        // κ° apiλ¥Ό λ³΄λ‚Όλ• ν—¤λ”μ— λ‹¤ ν† ν°μ„ ν•λ‚ν•λ‚ λ„£μ—λ‹¤

```

### 5.2 μ‘λ‹µ μΈν„°μ…‰ν„°

μ΄μ–΄μ„ μ•„λλ” μ‘λ‹µ μΈν„°μ…‰ν„°λ¥Ό μ„¤μ •ν•©λ‹λ‹¤. λ§ κ·Έλ€λ΅ μ„λ²„λ΅λ¶€ν„° μ‘λ‹µμ„ μ²λ¦¬ν•κΈ° μ‚¬μ „μ— μ‘μ—…ν•λ” λ‚΄μ©μΌλ΅ λ§μ•½ ν† ν°λ§λ£μ— λ€ν• 401μ—λ¬κ°€ λ°μƒν–λ‹¤λ©΄ μ¬λ°κΈ‰μ”μ²­μ„ μ§„ν–‰ν•κ³  μ›λμ μ”μ²­μ„ λ‹¤μ‹ λ³΄λ‚΄λ” λ΅μ§μΌλ΅ κµ¬ν„ν•μ€μµλ‹λ‹¤.

```javascript
axiosInstance.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    if (error.response.status === 401) {
      const refreshToken = localStorage.getItem("refreshToken");

    if (refreshToken != null) {
        const refreshedAccessToken = await updateAccessToken(refreshToken);
         // ν† ν° κ°±μ‹  api μ”μ²­

        if (refreshedAccessToken) {
           originalRequest.headers.Authorization = `Bearer ${refreshedAccessToken}`;

          return axiosInstance(originalRequest);
      }
    }

    // λ΅κ·ΈμΈ λ§λ£ μμ™Έμ²λ¦¬ (refreshTokenλ§λ£)

    return Promise.reject(error);
  },
);

```

μ„ λ°©μ‹μΌλ΅ κµ¬ν„ν•λ©΄ μ‚¬μ©μμ…μ¥μ—μ„λ” ν† ν°μ„ μ¬λ°κΈ‰ν•κ³  ν•΄λ‹Ή μ‘λ‹µμ— λ€ν• μ”μ²­μ„ λ‹¤μ‹ λ³΄λ‚΄κΈ°λ•λ¬Έμ— λκΉ€ μ—†μ΄ μμ—°μ¤λ½κ² μ„λΉ„μ¤λ¥Ό μ΄μ©ν•  μ μμµλ‹λ‹¤.

## μ°Έκ³ μλ£

[https://github.com/axios/axios](https://github.com/axios/axios)
